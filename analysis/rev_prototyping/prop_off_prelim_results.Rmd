---
title: "Prop off"
author: Renata Diaz
date: "`r Sys.Date()`"
output: 
    github_document:
       df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(drake)
library(dplyr)
library(ggplot2)
library(grid)
theme_set(theme_bw())

all_di <- read.csv(here::here("analysis", "rev_prototyping", "mcdb_di.csv")) 

all_di <- all_di %>%
  filter(s0 > 1,
         s0 != n0,
         n0 != s0 + 1) %>%
  mutate(prop_off_sig_mean = mean_prop_off_actual >= prop_off_sim_95,
         prop_off_sig_5pc = prop_off_actual_5 >= prop_off_sim_95)


```


```{r}


ggplot(filter(all_di, n_po_comparisons > 20), aes(mean_po_comparison_percentile)) +
  geom_histogram() +
  facet_wrap(vars(singletons), scales = "free_y")


ggplot(filter(all_di, n_po_comparisons > 20), aes(n_po_comparisons)) +
  geom_histogram()

all_di %>% group_by(singletons) %>% summarize(po_sig = mean(mean_po_comparison_percentile > 95))


ggplot(all_di, aes(mean_po_comparison_95, mean_po_comparison, color = log(nparts))) +
  geom_point() +
  geom_line(aes(mean_po_comparison_95, mean_po_comparison_95))


all_di %>%
  filter(mean_po_comparison_percentile > 95) %>%
  group_by(singletons) %>%
  summarize(diff = mean(mean_po_comparison - mean_po_comparison_95))

ggplot(all_di, aes(nparts, mean_po_comparison_95_ratio_1t)) +
  geom_point() +
  scale_x_log10()



ggplot(all_di, aes(nparts, mean_po_comparison_95_ratio_1t)) +
  geom_point() +
  scale_x_log10() +
  xlim(0, 10000)

```


